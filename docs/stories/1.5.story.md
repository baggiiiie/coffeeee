# Story 1.5: User Logout

## Status
Draft

## Story
As an authenticated user, I want to log out, so that I can securely end my session and prevent unauthorized access to my account on this device.

## Acceptance Criteria
1. A visible "Logout" action is available in the UI when the user is authenticated (e.g., in the header menu). [Source: docs/architecture/frontend-architecture.md#react-component-hierarchy]
2. Invoking "Logout" clears the stored authentication token from localStorage and resets in-memory auth state. [Source: docs/architecture/frontend-architecture.md#state-management-strategy] [Source: docs/architecture/frontend-architecture.md#state-persistence]
3. After logging out, the app redirects the user to `/login`. [Source: docs/architecture/frontend-architecture.md#routing-strategy]
4. Accessing any protected route while unauthenticated redirects to `/login`. [Source: docs/architecture/frontend-architecture.md#route-guards]
5. If the token is invalid or expired (e.g., detected via a 401 from the backend), the app automatically logs the user out and redirects to `/login`. [Source: docs/architecture/frontend-architecture.md#route-guards]

## Tasks / Subtasks
- [ ] Frontend: AuthContext logout implementation (AC: 2, 3)
  - [ ] Add `logout()` to `AuthContext` to clear token from localStorage and reset auth state [Source: docs/architecture/frontend-architecture.md#state-persistence]
  - [ ] Ensure `logout()` performs navigation to `/login` [Source: docs/architecture/frontend-architecture.md#routing-strategy]
- [ ] Frontend: Header UI integration (AC: 1)
  - [ ] Show "Logout" action when authenticated; hide when not [Source: docs/architecture/frontend-architecture.md#react-component-hierarchy]
  - [ ] Wire "Logout" action to call `logout()` [Source: docs/architecture/frontend-architecture.md#state-management-strategy]
- [ ] Frontend: Route guards and auto-logout on invalid token (AC: 4, 5)
  - [ ] Ensure Protected Routes check `isAuthenticated` and redirect unauthenticated users to `/login` [Source: docs/architecture/frontend-architecture.md#route-guards]
  - [ ] Add API error interceptor/handler to detect 401 responses and trigger `logout()` [Source: docs/architecture/frontend-architecture.md#route-guards]
- [ ] Tests (AC: 2, 3, 4, 5)
  - [ ] Component test: clicking "Logout" clears token and redirects to `/login` [Source: docs/architecture/development-workflow.md#frontend-testing]
  - [ ] Route guard test: unauthenticated access to a protected route redirects to `/login` [Source: docs/architecture/development-workflow.md#frontend-testing]
  - [ ] Token invalidation test: simulated 401 triggers auto-logout and redirect [Source: docs/architecture/development-workflow.md#frontend-testing]

## Dev Notes
The following guidance is extracted from architecture and PRD; no assumptions beyond cited sources.

### Previous Story Insights
- Story 1.4 implements login and JWT storage. Logout must remove the token and return the user to a non-authenticated state. [Source: docs/stories/1.4.story.md]

### Frontend Architecture
- Auth state is provided via `AuthContext`; tokens are persisted in `localStorage`. Implement `logout()` to clear token and reset context state. [Source: docs/architecture/frontend-architecture.md#state-management-strategy] [Source: docs/architecture/frontend-architecture.md#state-persistence]
- Routing uses public and protected routes; guards should enforce redirect to `/login` when the user is not authenticated. [Source: docs/architecture/frontend-architecture.md#routing-strategy] [Source: docs/architecture/frontend-architecture.md#route-guards]
- Consider a global API error handler/interceptor to catch 401 responses and invoke `logout()` automatically. [Source: docs/architecture/frontend-architecture.md#route-guards]

### File Locations / Project Structure
- Frontend: `apps/frontend/src/context/AuthContext.tsx`, `apps/frontend/src/components/Header.tsx`, router setup in `apps/frontend/src/App.tsx` (or entry that defines routes). [Source: docs/architecture/source-tree.md#monorepo-organization]

### Testing Requirements
- Add component tests covering logout action behavior, protected route redirects, and 401-triggered auto-logout. [Source: docs/architecture/development-workflow.md#frontend-testing]

### Technical Constraints
- Tech stack: React 18 + TypeScript; state via Context; token persistence in `localStorage`. [Source: docs/architecture/tech-stack.md#technology-stack-table]

### Project Structure Notes
- Ensure the logout UI placement aligns with the `Header` and navigation design in the component hierarchy. [Source: docs/architecture/frontend-architecture.md#react-component-hierarchy]

## Testing
- Component test for "Logout" interaction: token cleared, state reset, redirect to `/login`. [Source: docs/architecture/development-workflow.md#frontend-testing]
- Route guard test: unauthenticated user cannot access protected routes; redirect enforced. [Source: docs/architecture/development-workflow.md#frontend-testing]
- 401 handling test: API 401 triggers `logout()` and redirect. [Source: docs/architecture/development-workflow.md#frontend-testing]

## Change Log
| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| {{DATE}} | 0.1 | Initial draft created for Story 1.5 | Scrum Master |

## Dev Agent Record
### Agent Model Used
_To be filled by Dev Agent_

### Debug Log References
_To be filled by Dev Agent_

### Completion Notes List
_To be filled by Dev Agent_

### File List
_To be filled by Dev Agent_

## QA Results
_To be completed by QA Agent_
