# Story 2.2: View Coffee Gallery

## Status
Approved

## Story
As a logged-in user, I want to see all the coffees I have logged in a visually appealing gallery, so that I can easily browse my coffee history.

## Acceptance Criteria
1. The dashboard links to a "My Coffees" page. [Source: docs/prd/epic-2-coffee-brew-logging.md#story-22-view-coffee-gallery]
2. The "My Coffees" page displays a grid of cards, each showing the photo (if available) and name of a coffee in the authenticated user's collection. [Source: docs/prd/epic-2-coffee-brew-logging.md#story-22-view-coffee-gallery]
3. The page fetches data from `GET /api/v1/coffees` to retrieve only coffees owned by the authenticated user. [Source: docs/architecture/backend-architecture.md#api-organization]
4. Clicking on a coffee card navigates the user to the detail page for that coffee. [Source: docs/prd/epic-2-coffee-brew-logging.md#story-22-view-coffee-gallery]

## Tasks / Subtasks
- [x] Frontend: Dashboard link to My Coffees (AC: 1)
  - [x] Add a visible "My Coffees" button/link on the authenticated dashboard that routes to the coffees gallery page. [Source: docs/architecture/frontend-architecture.md#react-component-hierarchy]
- [x] Frontend: My Coffees page with grid (AC: 2)
  - [x] Implement `apps/frontend/src/pages/CoffeeListPage.tsx` to serve as "My Coffees" with appropriate title and UX. [Source: docs/architecture/frontend-architecture.md#react-component-hierarchy]
  - [x] Display a responsive MUI Grid of cards showing photo (or placeholder) and name. [Source: docs/architecture/components.md#frontend-components-pagesviews] [Source: docs/architecture/frontend-architecture.md#styling-architecture]
  - [x] Use `data-testid` attributes for key elements (grid container, card, card-title). [Source: docs/architecture/development-workflow.md#frontend-testing]
- [x] Frontend: Data fetching and navigation (AC: 2, 3)
  - [x] Fetch user coffees via API module using `GET /api/v1/coffees`; handle loading and error states with existing patterns. [Source: docs/architecture/backend-architecture.md#api-organization] [Source: docs/architecture/error-handling-strategy.md#frontend-error-handling]
  - [x] On card click, navigate to coffee detail route (e.g., `/coffees/:id`). [Source: docs/architecture/frontend-architecture.md#routing-strategy]
- [x] Backend: Verify/implement coffees list endpoint (supporting AC: 2)
  - [x] Implement `GET /api/v1/coffees` endpoint returning coffees owned by the authenticated user, including `photo_path`. [Source: docs/architecture/backend-architecture.md#api-organization]
  - [x] Return JSON with appropriate `Content-Type` and structured error responses on failure. [Source: docs/architecture/error-handling-strategy.md#backend-error-handling]
- [x] Tests (AC: 1â€“3)
  - [x] Frontend tests: dashboard link presence; grid renders items; navigation to detail page on card click; empty-state message when no coffees. [Source: docs/architecture/development-workflow.md#frontend-testing]
  - [x] Backend tests: `GET /api/v1/coffees` returns 200 with array payload. [Source: docs/architecture/development-workflow.md#backend-testing]

## Dev Notes
The following guidance is extracted from architecture and PRD; no assumptions beyond cited sources.

### Previous Story Insights
- Story 2.1 establishes adding coffees to a user's collection via per-user linkage; this gallery surfaces those coffees for browsing. [Source: docs/stories/2.1.story.md]

### Data Models
- Coffee model includes `Name`, `Origin`, `Roaster`, `Description`, `PhotoPath`, timestamps. [Source: docs/architecture/data-models.md#coffee-model]
- Per-user ownership is modeled directly on `coffees.user_id` (no join table). Gallery should use `coffees.photo_path` if present, otherwise a placeholder. [Source: docs/architecture/database-schema.md#database-relationships]

### API Specifications
- Use `GET /api/v1/coffees` to retrieve only the current user's coffees; consider client-side pagination. [Source: docs/architecture/backend-architecture.md#api-organization]
- Follow structured error handling for failed requests, surfacing user-friendly messages. [Source: docs/architecture/error-handling-strategy.md#frontend-error-handling]

### Component Specifications
- Page composition uses MUI Grid for cards, responsive across breakpoints. [Source: docs/architecture/frontend-architecture.md#styling-architecture]
- Card displays coffee photo (from `photoPath` if available) and name; clicking card navigates to detail page. [Source: docs/architecture/frontend-architecture.md#react-component-hierarchy]

### File Locations / Project Structure
- Frontend pages: `apps/frontend/src/pages/` (e.g., `MyCoffeesPage.tsx`), shared components in `apps/frontend/src/components/` (e.g., `CoffeeCard`). [Source: docs/architecture/source-tree.md#monorepo-organization]
- Routing under protected routes per frontend architecture; add `/coffees` or `/my-coffees` as needed. [Source: docs/architecture/frontend-architecture.md#routing-strategy]

### Testing Requirements
- Frontend: Jest + React Testing Library to verify grid rendering, navigation behavior, error/empty states, and presence of test IDs. [Source: docs/architecture/development-workflow.md#frontend-testing]
- Backend: Ensure endpoint tests for `GET /coffees` exist or add minimal coverage for success and error cases. [Source: docs/architecture/development-workflow.md#backend-testing]

### Technical Constraints
- Photo storage is not defined for MVP; treat images as optional URLs (`photoPath`) if present; otherwise use a placeholder asset. [Source: docs/architecture/tech-stack.md#technology-stack-table]

### Project Structure Notes
- PRD references a dedicated "My Coffees" page; architecture lists a generic `CoffeeListPage`. For MVP, implement a `MyCoffeesPage` that uses the per-user endpoint and existing `CoffeeCard` components. [Source: docs/architecture/frontend-architecture.md#react-component-hierarchy]

## Testing
- Frontend: component and routing tests for dashboard link, gallery grid, and card navigation; handle empty/error states. [Source: docs/architecture/development-workflow.md#frontend-testing]
- Backend: API integration tests for coffee listing endpoint. [Source: docs/architecture/development-workflow.md#api-integration-testing]

## Change Log
| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| {{DATE}} | 0.1 | Initial draft created for Story 2.2 | Scrum Master |

## Dev Agent Record
### Agent Model Used
James (Dev)

### Debug Log References
- Implemented backend `ListForMe` and route wiring; added unit test
- Implemented `CoffeeListPage` with API fetch, grid, and navigation
- Added dashboard link and tests; verified all frontend tests passing
- Validated backend tests with `GOCACHE` to satisfy sandbox constraints

### Completion Notes List
- Added protected GET `/api/v1/coffees` endpoint
- Frontend gallery page renders user-owned coffees with photos and names
- Dashboard includes quick link to My Coffees
- Tests cover frontend grid and navigation; backend returns only owner coffees

### File List
- apps/backend/internal/api/handlers/coffee.go (added ListForMe)
- apps/backend/internal/api/routes/routes.go (wire GET /coffees)
- apps/backend/internal/api/handlers/coffee_list_test.go (new)
- apps/frontend/src/pages/CoffeeListPage.tsx (implemented)
- apps/frontend/src/pages/CoffeeListPage.test.tsx (new)
- apps/frontend/src/pages/Dashboard.tsx (added My Coffees button)
- apps/frontend/src/pages/Dashboard.test.tsx (new)

## QA Results
_To be completed by QA Agent_
